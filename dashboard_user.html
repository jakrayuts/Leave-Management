<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard พนักงาน</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #f4f6f9;
      font-family: 'Segoe UI', sans-serif;
      padding: 2rem;
    }

    .chart-container {
      width: 100%;
      max-width: 500px;
      margin: auto;
    }

    .table-container {
      margin-top: 2rem;
    }

    .btn-group {
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
    }

    .logout-btn {
      background-color: #ff6b6b;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="btn-group">
      <button onclick="location.href='leave.html'" class="btn btn-primary">ขอลา</button>
      <button onclick="logout()" class="btn logout-btn">ออกจากระบบ</button>
    </div>

    <h3 class="text-center">สรุปประเภทการลา</h3>
    <div class="chart-container">
      <canvas id="leaveChart"></canvas>
    </div>

    <div class="table-container">
      <h4>ประวัติการลา</h4>
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>วันที่เริ่ม</th>
            <th>วันที่สิ้นสุด</th>
            <th>ประเภท</th>
            <th>สถานะ</th>
          </tr>
        </thead>
        <tbody id="leaveTableBody">
          <!-- รายการจะถูกเพิ่มด้วย JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Supabase -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabaseUrl = 'https://leave-system.supabase.co';
    const supabaseKey = 'YOUR_SUPABASE_ANON_KEY'; // เปลี่ยนตรงนี้
    const supabase = createClient(supabaseUrl, supabaseKey);

    // โหลดข้อมูลการลา
   function renderChart(data) {
  // ✅ กำหนดประเภทการลาที่ต้องการให้แสดงเสมอ
  const leaveTypes = ['ลากิจ', 'ลาป่วย'];

  // ✅ นับจำนวนแต่ละประเภท
  const typeCounts = data.reduce((acc, item) => {
    acc[item.leave_type] = (acc[item.leave_type] || 0) + 1;
    return acc;
  }, {});

  // ✅ สร้าง array ใหม่ให้มีค่าครบทุกประเภท
  const counts = leaveTypes.map(type => typeCounts[type] || 0);

  const ctx = document.getElementById('leaveChart').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: leaveTypes,
      datasets: [{
        label: 'การลา',
        data: counts,
        backgroundColor: ['#4b7bec', '#fc5c65', '#fed330']
      }]
    }
  });
}


    // ตารางประวัติ
    function renderTable(data) {
      const tbody = document.getElementById('leaveTableBody');
      tbody.innerHTML = '';

      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.date_start}</td>
          <td>${row.date_end}</td>
          <td>${row.leave_type}</td>
          <td>${row.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // กราฟประเภทการลา
    function renderChart(data) {
      const typeCounts = data.reduce((acc, item) => {
        acc[item.leave_type] = (acc[item.leave_type] || 0) + 1;
        return acc;
      }, {});

      const ctx = document.getElementById('leaveChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(typeCounts),
          datasets: [{
            label: 'การลา',
            data: Object.values(typeCounts),
            backgroundColor: ['#4b7bec', '#fc5c65', '#fed330']
          }]
        }
      });
    }

    function logout() {
      sessionStorage.clear();
      location.href = 'login.html'; // กลับไปหน้า login
    }

    loadDashboard();
  </script>
</body>
</html>
